<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Configure Tailwind theme -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              light: '#60a5fa',
              DEFAULT: '#3b82f6',
              dark: '#2563eb',
            },
            secondary: {
              light: '#a78bfa',
              DEFAULT: '#8b5cf6',
              dark: '#7c3aed',
            },
          }
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .bg-gradient-navbar {
        background: linear-gradient(90deg, #3b82f6, #7c3aed);
      }
    }
  </style>
</head>

<body class="bg-gray-50 font-sans pt-24">
  <!-- Fixed Top Navbar -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-gradient-navbar shadow-md">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-20">
        <a href="#" class="text-white font-bold text-2xl flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="6"></circle>
            <circle cx="12" cy="12" r="2"></circle>
          </svg>
          Smart Dashboard
        </a>
        <div class="flex items-center">
          <span class="text-white mr-4 text-lg">Logged in as <strong>{{ session['user'] }}</strong></span>
          <a href="{{ url_for('logout') }}"
            class="inline-flex items-center px-4 py-2 border border-white rounded-md text-base font-medium text-white hover:bg-white hover:text-indigo-600 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-6">
    <!-- Live Video Feed Card -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
      <div class="bg-gray-800 text-white px-5 py-4 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="23 7 16 12 23 17 23 7"></polygon>
          <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
        </svg>
        <span class="text-xl font-medium">Live Video Feed</span>
      </div>
      <div class="p-0">
        <div class="max-w-3xl mx-auto bg-black p-4">
          <img src="{{ url_for('video_feed') }}" alt="Live Video Feed" class="w-full h-auto rounded-lg" />
        </div>
      </div>
    </div>

    <!-- Add Known Face Button -->
    <div class="text-center mb-10">
      <a href="{{ url_for('add_known_face') }}"
        class="inline-flex items-center px-8 py-4 bg-emerald-600 text-white text-lg font-medium rounded-lg shadow-md hover:bg-emerald-700 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="8.5" cy="7" r="4"></circle>
          <line x1="20" y1="8" x2="20" y2="14"></line>
          <line x1="23" y1="11" x2="17" y2="11"></line>
        </svg>
        Add Known Face
      </a>

      <!-- View Alerts Button -->
      <a href="{{ url_for('alerts') }}"
        class="inline-flex items-center px-8 py-4 bg-primary text-white text-lg font-medium rounded-lg shadow-md hover:bg-primary-dark transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M13 16h-1v-4h-1m1-4h.01M21 12c0-4.97-4.03-9-9-9S3 7.03 3 12s4.03 9 9 9 9-4.03 9-9z"></path>
        </svg>
        View Alerts
      </a>
    </div>

    <!-- Alert Container -->
    <div id="alerts" class="fixed bottom-5 right-5 w-96 z-50"></div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.min.js"></script>

  <!-- Socket.IO Logic -->
  <script>
    const socket = io();

    socket.on('connect', () => {
      console.log('ðŸ”Œ Socket connected!');
    });

    socket.on('alert', function (data) {
      let alertType = data.type === 'familiar' ? 'success' : 'danger';
      let alertClass = alertType === 'success' ? 'bg-green-100 border-green-500 text-green-700' : 'bg-red-100 border-red-500 text-red-700';
      let alertMessage = data.message;

      let alertDiv = document.createElement('div');
      alertDiv.className = `${alertClass} px-5 py-4 rounded-lg border-l-4 shadow-md mb-3 flex items-center justify-between text-base`;
      alertDiv.innerHTML = `
        <span>${alertMessage}</span>
        <button type="button" class="text-gray-500 hover:text-gray-700" onclick="this.parentElement.remove()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      `;

      document.getElementById('alerts').appendChild(alertDiv);

      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 5000);
    });
  </script>
</body>

</html>